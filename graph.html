<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title> People who use X use Y </title>
  <style>

  .node circle {
    stroke: #fff;
    stroke-width: 1.5px;
  }

  .center-node {
    fill: #f00;
  }

  .link {
    stroke: #333;
    stroke-opacity: .6;
  }

  </style>
  <link href="libs/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span3">
          <h2> What do you want to see? </h2>
          <form action="graph.html">
              <label for="cmd">Central command:</label> 
              <input id="cmd" name="center">
              <label for="degree">How many degrees away:</label> 
              <input id="degree" name="degree">
              <label for="min-correlation">Minimum correlation:</label> 
              <input id="min-correlation" name="min_correlation"> <br>
              <input type="submit" value="Submit">
          </form>
          <input type="submit" value="Centre at random node" onclick="reload({center: random_node(), degree: 2});">
          <h2> What is this? </h2>

          <p>
          I ran a <a
            href="https://docs.google.com/forms/d/1XNMoSdfYFe_WkPfU--M88oL00PDLIOAo1HxjhZvZYJ4/viewform">survey</a>
          on <a href="http://news.ycombinator.com">Hacker
            News</a> a little while ago asking people to submit their
          top 100 commands from their <code>.bash_history</code>
          </p>
          <p>

          Then I calculated some correlations. This is a network of
          commands which are highly correlated together. You can centre
          it at <code>gcc</code> and find out that people also run
          <code>./a.out</code>
          </p>

          <p>
          The colours don't mean anything.
          </p>

      </div>
      <div class="span9 main">
      </div>
    </div>
  </div>
<script src="libs/d3.v3.min.js"></script>
<!-- <script src="libs/d3.js"></script> -->
<script src="libs/jquery.min.js"></script>
<script src="graph.js"></script>
<script>

var width = 960,
    height = 600;


var color = d3.scale.category10();

var zoom = 2;
var force = d3.layout.force()
    .charge(-150 * zoom)
    .linkDistance(50 * zoom)
    // .linkStrength(function(l) {return l.value * 5})
    .linkStrength(0.3)
    .gravity(0.1)
    .size([width, height]);

var svg = d3.select("div.main").append("svg")
    .attr("width", width)
    .attr("height", height);

var complete_graph;

function reload(params) {
  d3.selectAll('.node').remove();
  d3.selectAll('.link').remove();
  var graph = complete_graph;
  if (params['min_correlation']) {
    $('#min-correlation').val(params['min_correlation']);
    graph = subgraph(graph, +params['min_correlation']);
  }
  if (params['center'] && params['degree']) {
    force.gravity(0.03);
    $('#degree').val(params['degree']);
    $('#cmd').val(params['center']);
    graph = subgraph_neighborhood(graph, params['center'], +params['degree']);
  }
  display_graph(graph, zoom, params['center']);
}

d3.json("unix-command-graph.json", function(error, graph) {
  set_links(graph);
  complete_graph = graph;
  var params = parse_get_params();
  if (!params['center']) {
    params['center'] = 'python';
  }
  if (!params['degree']) {
    params['degree'] = 2;
  }
  reload(params);
});
</script>
